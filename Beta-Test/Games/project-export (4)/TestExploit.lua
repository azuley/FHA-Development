-- Universal Exploit Test Script
-- Testa todas as funcionalidades do exploit

print("========================================")
print("Universal Exploit Test Suite")
print("Version: 2.1.0")
print("========================================")

-- Test 1: Environment Check
print("\n[TEST 1] Environment Check...")
local environmentOK = true

-- Check Roblox services
local requiredServices = {
    "Players",
    "RunService",
    "UserInputService",
    "TweenService",
    "CoreGui",
    "TeleportService",
    "HttpService"
}

for _, serviceName in ipairs(requiredServices) do
    local success, service = pcall(function()
        return game:GetService(serviceName)
    end)
    
    if success then
        print("  ✅ " .. serviceName .. " OK")
    else
        print("  ❌ " .. serviceName .. " FAILED")
        environmentOK = false
    end
end

-- Test 2: Player Check
print("\n[TEST 2] Player Check...")
local playerOK = false

local Players = game:GetService("Players")
if Players.LocalPlayer then
    print("  ✅ LocalPlayer found: " .. Players.LocalPlayer.Name)
    playerOK = true
else
    print("  ❌ No LocalPlayer found")
    environmentOK = false
end

-- Test 3: Executor Detection
print("\n[TEST 3] Executor Detection...")
local executorDetected = false
local executorName = "Unknown"

if syn then
    executorName = "Synapse X"
    executorDetected = true
elseif KRNL_LOADED then
    executorName = "KRNL"
    executorDetected = true
elseif PROTOSMASHER_LOADED then
    executorName = "ProtoSmasher"
    executorDetected = true
elseif identifyexecutor then
    executorName = identifyexecutor() or "Unknown"
    executorDetected = true
elseif getexecutorname then
    executorName = getexecutorname() or "Unknown"
    executorDetected = true
else
    -- Try other detection methods
    if debug and debug.getupvalue then
        executorName = "Script-Ware/Other"
        executorDetected = true
    end
end

print("  Detected: " .. executorName)
print("  Supported: " .. tostring(executorDetected))

-- Test 4: Load Exploit
print("\n[TEST 4] Loading Exploit...")
local exploitLoaded = false

if environmentOK and playerOK then
    local success, err = pcall(function()
        -- Try to load the main exploit
        print("  Attempting to load UniversalExploit.lua...")
        
        -- Method 1: Direct load (if file exists)
        if readfile and isfile and isfile("UniversalExploit.lua") then
            local exploitCode = readfile("UniversalExploit.lua")
            local exploitFunc = loadstring(exploitCode)
            if exploitFunc then
                exploitFunc()
                exploitLoaded = true
                print("  ✅ Exploit loaded from file")
            end
        else
            -- Method 2: Create minimal test GUI
            print("  Creating test interface...")
            
            local CoreGui = game:GetService("CoreGui")
            local testGui = Instance.new("ScreenGui")
            testGui.Name = "TestGUI"
            testGui.Parent = CoreGui
            
            local testFrame = Instance.new("Frame")
            testFrame.Size = UDim2.new(0, 200, 0, 100)
            testFrame.Position = UDim2.new(0.5, -100, 0.5, -50)
            testFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
            testFrame.Parent = testGui
            
            local testLabel = Instance.new("TextLabel")
            testLabel.Size = UDim2.new(1, 0, 1, 0)
            testLabel.BackgroundTransparency = 1
            testLabel.Text = "Test GUI Loaded!\nExploit Ready"
            testLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            testLabel.TextSize = 16
            testLabel.Parent = testFrame
            
            exploitLoaded = true
            print("  ✅ Test interface created")
        end
    end)
    
    if not success then
        print("  ❌ Error loading exploit: " .. tostring(err))
    end
else
    print("  ❌ Skipping - environment check failed")
end

-- Test 5: Feature Tests
print("\n[TEST 5] Feature Tests...")

-- Test fly function
local function testFlyFunction()
    print("  Testing fly function...")
    
    -- Create mock fly function
    local flyActive = false
    local flyBodyVelocity = nil
    local flyBodyGyro = nil
    
    local function activateFly()
        flyActive = true
        print("    Fly: ACTIVATED")
        return true
    end
    
    local function deactivateFly()
        flyActive = false
        print("    Fly: DEACTIVATED")
        return true
    end
    
    -- Test activation
    local flyTest1 = activateFly()
    local flyTest2 = deactivateFly()
    
    if flyTest1 and flyTest2 then
        print("  ✅ Fly functions OK")
        return true
    else
        print("  ❌ Fly functions FAILED")
        return false
    end
end

-- Test ESP function
local function testESPFunction()
    print("  Testing ESP function...")
    
    local Players = game:GetService("Players")
    local playerCount = #Players:GetPlayers()
    
    print("    Players in game: " .. playerCount)
    
    if playerCount > 1 then
        print("  ✅ ESP test possible")
        return true
    else
        print("  ⚠️ ESP test skipped (not enough players)")
        return true
    end
end

-- Test teleport function
local function testTeleportFunction()
    print("  Testing teleport function...")
    
    local function teleportTo(position)
        print("    Teleporting to: " .. tostring(position))
        return true
    end
    
    local testPos = Vector3.new(0, 10, 0)
    local teleportTest = teleportTo(testPos)
    
    if teleportTest then
        print("  ✅ Teleport function OK")
        return true
    else
        print("  ❌ Teleport function FAILED")
        return false
    end
end

-- Run feature tests
local featureTests = {
    {name = "Fly", func = testFlyFunction},
    {name = "ESP", func = testESPFunction},
    {name = "Teleport", func = testTeleportFunction}
}

local featuresOK = true
for _, test in ipairs(featureTests) do
    local success, result = pcall(test.func)
    if success and result then
        -- Test passed
    else
        featuresOK = false
        print("  ❌ " .. test.name .. " test FAILED")
    end
end

-- Final Results
print("\n========================================")
print("TEST RESULTS")
print("========================================")

print("Environment: " .. (environmentOK and "✅ PASS" or "❌ FAIL"))
print("Player: " .. (playerOK and "✅ PASS" or "❌ FAIL"))
print("Executor: " .. (executorDetected and "✅ DETECTED" or "⚠️ NOT DETECTED"))
print("Exploit Load: " .. (exploitLoaded and "✅ SUCCESS" or "❌ FAILED"))
print("Features: " .. (featuresOK and "✅ PASS" or "❌ FAIL"))

print("\nOverall Status: " .. 
    (environmentOK and playerOK and exploitLoaded and featuresOK and "✅ READY" or "❌ NOT READY"))

print("\n========================================")
print("RECOMMENDATIONS:")

if not environmentOK then
    print("- Make sure you're in a Roblox game")
    print("- Check if game services are available")
end

if not playerOK then
    print("- Wait until you fully spawn in the game")
    print("- Make sure you're not in the lobby")
end

if not executorDetected then
    print("- Your executor might not be fully supported")
    print("- Try using Synapse X, KRNL, or Script-Ware")
end

if not exploitLoaded then
    print("- Make sure UniversalExploit.lua exists")
    print("- Check file permissions")
    print("- Try running Loader.lua instead")
end

if not featuresOK then
    print("- Some features may not work in this game")
    print("- Try different game modes")
end

print("\nNext steps:")
print("1. Run Loader.lua to load the exploit")
print("2. Press RightControl to open the menu")
print("3. Enable features from the Main tab")

print("\n========================================")
print("Test completed at: " .. os.date("%H:%M:%S"))
print("========================================")

-- Return test results
return {
    Environment = environmentOK,
    Player = playerOK,
    Executor = executorDetected,
    ExploitLoaded = exploitLoaded,
    Features = featuresOK,
    AllTestsPassed = environmentOK and playerOK and exploitLoaded and featuresOK,
    Timestamp = os.time()
}